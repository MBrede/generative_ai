<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>LLM pipelines ‚Äì Generative AI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../content/diff_models.html" rel="next">
<link href="../content/agent_basics.html" rel="prev">
<link href="../cover.jpg" rel="icon" type="image/jpeg">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-7c56b0cb14979e59e30aba88ccee8faa.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="mermaid-theme" content="neutral">
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../content/getting_started_with_llms.html">Language Models</a></li><li class="breadcrumb-item"><a href="../content/agent_interaction.html"><span class="chapter-title">LLM pipelines</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../cover.jpg" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../cover.jpg" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Generative AI</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/MBrede/generative_ai" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../Generative-AI.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/orga.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Organizational Details</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/project_details.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Project Details</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Language Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/getting_started_with_llms.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Getting started with (L)LMs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/prompting.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Prompting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/function_calling.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Towards Agents: chatbots and function calling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/embeddings.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Embedding-based LLM-systems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/agent_basics.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Agents and Pipelines</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/agent_interaction.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">LLM pipelines</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Image Generation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/diff_models.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">AI image generation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/generation_in_agent_pipelines.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">AI image generation pipelines</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Finetuning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/finetuning_approaches.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Finetuning Approaches</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/alignment.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Alignment</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title"><img src="../imgs/llm-pipeline.jpg" class="img-fluid" width="240"><br><br>
</h2><h3 class="anchored"><br>
LLM pipelines<br>
</h3>
   
  <ul>
  <li><a href="#motivation-and-learning-objectives" id="toc-motivation-and-learning-objectives" class="nav-link active" data-scroll-target="#motivation-and-learning-objectives">Motivation and learning objectives</a></li>
  <li><a href="#pipelines-from-input-to-output" id="toc-pipelines-from-input-to-output" class="nav-link" data-scroll-target="#pipelines-from-input-to-output">Pipelines: from input to output</a>
  <ul class="collapse">
  <li><a href="#example-simple-eda-pipeline-no-agent" id="toc-example-simple-eda-pipeline-no-agent" class="nav-link" data-scroll-target="#example-simple-eda-pipeline-no-agent">Example: simple EDA pipeline (no agent)</a></li>
  </ul></li>
  <li><a href="#sec-llmJudge" id="toc-sec-llmJudge" class="nav-link" data-scroll-target="#sec-llmJudge">LLM as a judge</a>
  <ul class="collapse">
  <li><a href="#benefits-and-drawbacks" id="toc-benefits-and-drawbacks" class="nav-link" data-scroll-target="#benefits-and-drawbacks">Benefits and drawbacks</a></li>
  </ul></li>
  <li><a href="#evaluation-pipelines-general-pattern" id="toc-evaluation-pipelines-general-pattern" class="nav-link" data-scroll-target="#evaluation-pipelines-general-pattern">Evaluation pipelines: general pattern</a></li>
  <li><a href="#example-dataset-hypothesis-creation-pipeline" id="toc-example-dataset-hypothesis-creation-pipeline" class="nav-link" data-scroll-target="#example-dataset-hypothesis-creation-pipeline">Example: Dataset hypothesis creation pipeline</a>
  <ul class="collapse">
  <li><a href="#generator" id="toc-generator" class="nav-link" data-scroll-target="#generator">Generator</a></li>
  <li><a href="#reviewer-llm-as-a-judge" id="toc-reviewer-llm-as-a-judge" class="nav-link" data-scroll-target="#reviewer-llm-as-a-judge">Reviewer (LLM as a judge)</a></li>
  <li><a href="#editor" id="toc-editor" class="nav-link" data-scroll-target="#editor">Editor</a></li>
  <li><a href="#full-pipeline" id="toc-full-pipeline" class="nav-link" data-scroll-target="#full-pipeline">Full pipeline</a></li>
  <li><a href="#from-pipeline-to-orchestrated-agents" id="toc-from-pipeline-to-orchestrated-agents" class="nav-link" data-scroll-target="#from-pipeline-to-orchestrated-agents">From pipeline to orchestrated agents</a></li>
  </ul></li>
  <li><a href="#project-work" id="toc-project-work" class="nav-link" data-scroll-target="#project-work">Project work</a></li>
  <li><a href="#further-readings" id="toc-further-readings" class="nav-link" data-scroll-target="#further-readings">Further Readings</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/MBrede/generative_ai/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../content/getting_started_with_llms.html">Language Models</a></li><li class="breadcrumb-item"><a href="../content/agent_interaction.html"><span class="chapter-title">LLM pipelines</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-evalpipelines" class="quarto-section-identifier"><span class="chapter-title">LLM pipelines</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- in @sec-agents we bla  -->
<section id="motivation-and-learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="motivation-and-learning-objectives">Motivation and learning objectives</h2>
<p>In session 5 we focused on <strong>agentic decision-making</strong> and the EDA agent as a motivating example. In this session, we will:</p>
<ul>
<li>distinguish more clearly between <strong>agents</strong> and <strong>LLM pipelines</strong>,</li>
<li>understand the concept of <strong>LLM as a judge</strong> and why evaluation is a bottleneck in generative AI systems,</li>
<li>design and discuss <strong>evaluation pipelines</strong> for our EDA agent and related use cases, and</li>
<li>connect these ideas to your own project work.</li>
</ul>
<p>After this session you should be able to:</p>
<ul>
<li>design a simple pipeline of LLM calls and tools,</li>
<li>use an LLM to evaluate model outputs along explicit criteria, and</li>
<li>reflect critically on the strengths and weaknesses of LLM-based evaluation.</li>
</ul>
</section>
<section id="pipelines-from-input-to-output" class="level2">
<h2 class="anchored" data-anchor-id="pipelines-from-input-to-output">Pipelines: from input to output</h2>
<p>As discussed, an agent decides dynamically which tools to use. A pipeline, in contrast, follows a pre-defined sequence of steps:</p>
<ol type="1">
<li>Receive input.</li>
<li>Transform it through a series of modules (some LLM calls, some classic code).</li>
<li>Produce an output ‚Äì optionally with internal loops, but without LLM-driven control flow.</li>
</ol>
<p>Pipelines are attractive because they are:</p>
<ul>
<li>easier to <strong>test and debug</strong>,</li>
<li>often more <strong>robust</strong>,</li>
<li>and usually more <strong>efficient</strong> than agentic setups when the workflow is well understood.</li>
</ul>
<section id="example-simple-eda-pipeline-no-agent" class="level3">
<h3 class="anchored" data-anchor-id="example-simple-eda-pipeline-no-agent">Example: simple EDA pipeline (no agent)</h3>
<p>A non-agentic pipeline for our EDA use case could be:</p>
<ol type="1">
<li><strong>Preprocessing</strong>: load the CSV, detect column types, basic validation.</li>
<li><strong>Analytics</strong>: compute standard statistics and sample plots using Python code.</li>
<li><strong>Report generation</strong>: call an LLM once to turn the statistics and plots into a narrative EDA report.</li>
</ol>
<p>No tool selection is delegated to the LLM; it only writes the report. This is already powerful ‚Äì but the <strong>quality</strong> of the report still varies, and we need a way to <strong>evaluate</strong> it.</p>
</section>
</section>
<section id="sec-llmJudge" class="level2">
<h2 class="anchored" data-anchor-id="sec-llmJudge">LLM as a judge</h2>
<p>The core idea of LLM as a judge is simple:</p>
<p><strong>Use a (possibly different) LLM to evaluate the quality of outputs produced by an LLM-based system.</strong></p>
<p><strong>Why is this useful?</strong></p>
<p>Consider a small experiment:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>üìù Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Open a notebook and connect it with a local LLM using LM Studio (or other).</li>
<li>Ask it to generate <strong>one</strong> story containing fried eggs on a sunrise.</li>
<li>Informally evaluate the story: What works well? What doesn‚Äôt? How did you decid</li>
<li>Now ask the model to generate <strong>50‚Äì100</strong> such stories (use a higher temperature).</li>
<li>Try to evaluate all of them manually‚Ä¶</li>
</ol>
<p>Reflect: How long does it take? How consistent are your own judgements?</p>
</div>
</div>
<p>Typical pattern:</p>
<ol type="1">
<li>We generate large amounts of text, code, or structured output.</li>
<li>We suspect that quality is variable.</li>
<li>We need a way to <strong>assess</strong> that quality.</li>
<li>Reading and judging everything manually is too slow and doesn‚Äôt scale. (We don‚Äôt have time for this.)</li>
</ol>
<p>Instead, we can use an LLM in an evaluation role:</p>
<ul>
<li>It receives the output to be evaluated (e.g.&nbsp;an EDA report).</li>
<li>It receives <strong>criteria</strong> (e.g.&nbsp;correctness, completeness, clarity).</li>
<li>It returns scores, labels, or structured feedback.</li>
</ul>
<p>The evaluation can then be used to:</p>
<ul>
<li>accept or reject outputs,</li>
<li>select the best out of several candidates,</li>
<li>give automated feedback for improvement,</li>
<li>or serve as a signal for fine-tuning or reinforcement learning (e.g.&nbsp;Constitutional AI <span class="citation" data-cites="ConstitutionalAIHarmlessness">(<a href="#ref-ConstitutionalAIHarmlessness" role="doc-biblioref"><em>Constitutional <span>AI</span></em>, n.d.</a>)</span>).</li>
</ul>
<p>This approach is called LLM as a judge.</p>
<section id="benefits-and-drawbacks" class="level3">
<h3 class="anchored" data-anchor-id="benefits-and-drawbacks">Benefits and drawbacks</h3>
<p><strong>Benefits:</strong></p>
<ul>
<li>Scales to large numbers of outputs.</li>
<li>Can approximate nuanced, qualitative judgements when well-prompted.</li>
<li>Easy to combine with existing systems (few additional components).</li>
<li>Flexible: different prompts and criteria for different tasks.</li>
</ul>
<p><strong>Drawbacks:</strong></p>
<ul>
<li><strong>Cost:</strong> multiple LLM calls per sample.</li>
<li><strong>Bias:</strong> models might prefer their own style or longer answers.</li>
<li><strong>Subjectivity:</strong> evaluation depends on the prompt and the judge model.</li>
<li><strong>Mismatch with humans:</strong> high scores do not always mean humans agree.</li>
</ul>
<p>Because of these limitations, LLM-based judgements should be:</p>
<ul>
<li>designed carefully (clear rubrics),</li>
<li>and, ideally, <strong>calibrated</strong> against human ratings.</li>
</ul>
</section>
</section>
<section id="evaluation-pipelines-general-pattern" class="level2">
<h2 class="anchored" data-anchor-id="evaluation-pipelines-general-pattern">Evaluation pipelines: general pattern</h2>
<p>Many applications follow a similar structure:</p>
<ol type="1">
<li><strong>Generator:</strong> produces a candidate output (text, code, EDA report, answer, ‚Ä¶).</li>
<li><strong>Judge:</strong> evaluates the output (via an LLM with evaluation prompt).</li>
<li><strong>Editor (optional):</strong> improves the output based on the feedback.</li>
<li><strong>Loop (optional):</strong> repeat 2 and 3 until a stopping criterion is met.</li>
</ol>
<p>This pattern applies to:</p>
<ul>
<li>EDA reports,</li>
<li>answers in Q&amp;A systems,</li>
<li>code generation,</li>
<li>many more</li>
</ul>
</section>
<section id="example-dataset-hypothesis-creation-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="example-dataset-hypothesis-creation-pipeline">Example: Dataset hypothesis creation pipeline</h2>
<p>We will now modify our EDA agent/pipeline from earlier to illustrate this. We will build a pipeline that will generate a <strong>hypothesis</strong> based on superficial knowledge of the dataset.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>‚ÑπÔ∏è Info
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>hypothesis</strong> is a testable prediction or proposed explanation for a phenomenon, based on limited evidence that serves as a starting point for further investigation. It typically takes the form of an ‚Äúif-then‚Äù statement that can be supported or refuted through experimentation and observation. A good scientific hypothesis must be <strong>falsifiable</strong> ‚Äî meaning there must be a possible way to prove it wrong through empirical evidence.</p>
</div>
</div>
<p>For now, we will not try to falsify (or verify) the hypothesis, just checking, if the generated output makes a good hypothesis. Our workflow looks thusly:</p>
<ol type="1">
<li><strong>Hypothesis generator</strong>
<ul>
<li>Receives the dataset and additional metadata about the data</li>
<li>Produces a hypothesis</li>
</ul></li>
<li><strong>Judge-LLM</strong>
<ul>
<li>Receives the hypothesis + a rubric, e.g.&nbsp;with criteria:
<ul>
<li>Is this a prediction?</li>
<li>Does it explain something?</li>
<li>Is it falsifiable?</li>
</ul></li>
<li>Returns:
<ul>
<li>scores (e.g.&nbsp;1‚Äì5) per criterion, and</li>
<li>short textual feedback for each.</li>
</ul></li>
</ul></li>
<li><strong>Optional editor step</strong>
<ul>
<li>Another LLM call (possibly with a different model) revises the hypothesis</li>
</ul></li>
<li><strong>Stopping condition</strong>
<ul>
<li>For example: stop after 2‚Äì3 improvement iterations or if all scores exceed a threshold.</li>
</ul></li>
</ol>
<section id="generator" class="level3">
<h3 class="anchored" data-anchor-id="generator">Generator</h3>
<p>Let‚Äôs have a closer look at the generator:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
data["`dataset,
metadata,
columns,
...`"]
gen(Generator)
hyp[Hypothesis]
data --&gt; gen
gen --&gt; hyp
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>A system prompt for the generator could be:</p>
<pre><code>You are a research asssistant tasked with generating a first hypothesis on a given dataset. 
You will receive a brief summary of the dataset in question. this might include metadata, example rows, a list of columns etc. 
Your Task is to generate a hypothesis based on this superficial knowledge, that will be testet at a later stage. </code></pre>
<p>When calling the generator, you should give the relevant information in the user prompt:</p>
<pre><code>Metadata:
{dataset_metadata}

columns: 
{dataset.columns}

example rows:
{dataset.head()}</code></pre>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>üìù Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Your turn!</p>
<p>In your notebook, implement a hypothesis generator.</p>
<ol type="1">
<li>Get a dataset. You can use the <a href="https://www.kaggle.com/competitions/titanic/data">the titanic dataset from kaggle</a> again or something else.</li>
<li>Compile some relevant information e.g.&nbsp;<code>df.head()</code>, <code>df.describe()</code> etc. along other information. The titanic dataset has a very good description at the website.</li>
<li>Send a good system prompt and the relevant information to an LLM. You may want to increase the model‚Äôs temperature.</li>
<li>Evaluate the results.</li>
</ol>
</div>
</div>
</section>
<section id="reviewer-llm-as-a-judge" class="level3">
<h3 class="anchored" data-anchor-id="reviewer-llm-as-a-judge">Reviewer (LLM as a judge)</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR

hyp[Hypothesis]
rev(Reviewer)
feedback[Feedback]
hyp --&gt; rev
rev --&gt; feedback
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The reviewer is a judge-LLM with a rubric for a good hypothesis:</p>
<pre><code>You are a research assistant. Your task is to review a hypothesis based on these rules:
1. Is this a prediction?
2. Does it explain something?
3. Is it falsifiable?
Provide concise feedback on how to improve the hypothesis.</code></pre>
<p>Here, LLM-as-judge is used to evaluate and guide improvements.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>üìù Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let‚Äôs build us a very judgemental robot!</p>
<ol type="1">
<li>In the same notebook, initialize a reviewer as well.</li>
<li>Let the reviewer review the hypothesis generated by the generator.</li>
<li>Adjust the rubric until the reviewer finds stuff to improve.</li>
</ol>
</div>
</div>
</section>
<section id="editor" class="level3">
<h3 class="anchored" data-anchor-id="editor">Editor</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
data["`dataset,
metadata,
columns,
...`"]

hyp[Hypothesis]
feedback[Feedback]
editor(Editor)
new_hyp[Hypothesis]
data --&gt; editor
hyp --&gt; editor
feedback --&gt; editor
editor --&gt; new_hyp
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The editor uses the original input + hypothesis + feedback to produce a revised hypothesis. Its prompt encodes this behaviour explicitly (incorporate feedback, keep focus, improve wording, etc.).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>üìù Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Time to improve!</p>
<ol type="1">
<li>In the same notebook, implement the editor as well. Make a new LLM call/prompt or adapt your original generator.</li>
<li>Let the editor generate a new hypothesis or improve an existing one based on the feedback from the reviewer.</li>
<li>Get the editor to actually generate something that is different from the generators version!</li>
</ol>
</div>
</div>
</section>
<section id="full-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="full-pipeline">Full pipeline</h3>
<p>We now basically have a working LLM-based pipeline.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
data["`dataset,
metadata,
columns,
...`"]
gen(Generator)
hyp[Hypothesis]
rev(Reviewer)
feedback[Feedback]
editor(Editor)
new_hyp[Hypothesis]
data --&gt; gen
gen --&gt; hyp
hyp --&gt; rev
rev --&gt; feedback
data --&gt; editor
hyp --&gt; editor
feedback --&gt; editor
editor --&gt; new_hyp
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>A good next step would be to add a loop around the review process, so that it only stops if the reviewer is happy. This could look like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>hypothesis <span class="op">=</span> generator.generate(dataset_description)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(max_iter):</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    review <span class="op">=</span> reviewer.review(hypothesis)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> review_is_positive_enough(review):</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    hypothesis <span class="op">=</span> editor.edit(dataset_description, hypothesis, review)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> hypothesis</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
data["`dataset,
metadata,
columns,
...`"]
gen(Generator)
hyp[Hypothesis]
rev(Reviewer)
feedback[Feedback]
editor(Editor)
if{good enough?}
stop((stop))
data --&gt; gen
gen --&gt; hyp
hyp --&gt; rev
rev --&gt; feedback
data --&gt; editor
hyp --&gt; editor
feedback --&gt; if
if -- no --&gt; editor
if -- yes --&gt; stop
editor --&gt; hyp
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The missing piece is review_is_positive_enough, where you might:</p>
<ul>
<li>search for a specific ‚ÄúOK‚Äù marker in the review,</li>
<li>ask the reviewer to output a score and threshold it,</li>
<li>or run an additional small LLM classification step.</li>
</ul>
<p>Alternatively, you can just generate a lot of hypotheses and choose the best one (or the best <em>n</em>).</p>
<p>Exactly the same pattern can be transferred to <strong>your own project outputs</strong>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>üìù Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Build it!</p>
<ol type="1">
<li>Think of a way to stop the review process once the hypothesis is good enough.</li>
<li>Implement the loop.</li>
</ol>
<p>This is the minimum goal for today, so when you are done, you can upload your notebook to moodle. Alternatively, go on and implement the agent (see below) as well!</p>
</div>
</div>
</section>
<section id="from-pipeline-to-orchestrated-agents" class="level3">
<h3 class="anchored" data-anchor-id="from-pipeline-to-orchestrated-agents">From pipeline to orchestrated agents</h3>
<p>The example above is still essentially a pipeline: the order of steps is fixed (Generator ‚Üí Reviewer ‚Üí Editor ‚Ä¶). We could, however, introduce an orchestrator agent that decides which component to call next:</p>
<pre><code>You are tasked with creating high-quality scientific hypothesis for a given dataset. Use the tools at your disposal to ensure good quality. 
Available tools:
‚Äì Generator ‚Äì creates hypotheses
‚Äì Reviewer ‚Äì evaluates hypothesis quality
‚Äì Editor ‚Äì improves hypothesis based on feedback
Decision guidelines:
‚Äì Use Generator to create hypothesis.
‚Äì Use Reviewer to generate feedback.
‚Äì Use Editor to improve hypothesis.
‚Äì Choose END when the hypothesis is good enough.
Output only the next agent to run ("Generator", "Reviewer", "Editor", or "END").</code></pre>
<p>The agent is now just a loop around this orchestrator:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pseudocode</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>initialize: </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    tools</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    history</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> true:</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> orchestrator(history)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response <span class="op">==</span> <span class="st">"END"</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response <span class="op">==</span> <span class="st">"generator"</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        history <span class="op">+=</span> generator.generate()</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># same for other tools</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../imgs/agent_loop_tinyagents.jpg" class="img-fluid figure-img"></p>
<figcaption>Image credit https://x.com/adamdotdev (from <a href="https://huggingface.co/blog/tiny-agents">the Tiny Agents blogpost</a>)</figcaption>
</figure>
</div>
<p>This is essentially the agentic version of the same pipeline. The pros and cons are analogous to those discussed in session <a href="agent_basics.html" class="quarto-xref"><span>Agents and Pipelines</span></a>:</p>
<ul>
<li>more flexibility,</li>
<li>but also more complexity and less predictability.</li>
</ul>
<p>For your projects, you should decide consciously whether you need this flexibility ‚Äì or whether a simple pipeline with a clear evaluation step is sufficient.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>üìù Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>In the same notebook, initialize the orchestrator agent as well.</li>
<li>Implement the workflow shown above in real code.</li>
<li>Watch happily as it all works without any issues whatsoever.</li>
<li>Upload to Moodle.</li>
</ol>
</div>
</div>
</section>
</section>
<section id="project-work" class="level2">
<h2 class="anchored" data-anchor-id="project-work">Project work</h2>
<p>Time to work on your projects!</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>üìù Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Discuss your project.</li>
<li>Set up the repository</li>
<li>Plan the project</li>
<li>Start collecting data or finding a data set</li>
<li>Start implementing</li>
</ol>
<p>Happy coding!</p>
</div>
</div>
</section>
<section id="further-readings" class="level2">
<h2 class="anchored" data-anchor-id="further-readings">Further Readings</h2>
<ul>
<li><a href="https://huggingface.co/blog/tiny-agents">the Tiny Agents blogpost</a> really helps understanding agents.</li>
<li><a href="https://www.youtube.com/watch?v=ewLMYLCWvcI">Here</a> is a video describing other multi-agent systems, including an <a href="https://arxiv.org/abs/2405.02957">agent hospital</a> and a <a href="https://arxiv.org/html/2405.11804v1">multi-agent translator</a></li>
</ul>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-ConstitutionalAIHarmlessness" class="csl-entry" role="listitem">
<em>Constitutional <span>AI</span>: <span>Harmlessness</span> from <span>AI Feedback</span></em>. (n.d.). https://www.anthropic.com/research/constitutional-ai-harmlessness-from-ai-feedback.
</div>
</div>
</section>

</main> <!-- /main -->
<script>
var elements = document.getElementsByClassName('card');

var myFunction = function() {
  var overlay = this.querySelector('.overlay');
  var content = this.querySelector('.content');
  content.classList.toggle('blur-effect');
  if (overlay) {
    overlay.classList.toggle('show-overlay')
  }
}

for (var i = 0; i < elements.length; i++) {
    elements[i].addEventListener('click', myFunction, false);
    myFunction.call(elements[i]);
}

document.addEventListener('DOMContentLoaded', function() {
  const images = document.querySelectorAll('.gif-image');
  
  images.forEach(function(image) {
    image.addEventListener('click', function() {
        console.log(this.src)
        console.log(this.src.slice(0,-4))
        if(this.src.substr(-4) == '.gif') {
          this.src = this.src.slice(0,-4) + '.png'
        } else {
          this.src = this.src.slice(0,-4) + '.gif'
        }
      });
  });
});

</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../content/agent_basics.html" class="pagination-link" aria-label="Agents and Pipelines">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Agents and Pipelines</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../content/diff_models.html" class="pagination-link" aria-label="AI image generation">
        <span class="nav-page-text"><span class="chapter-title">AI image generation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a rel="license" href=" https://creativecommons.org/licenses/by-nc-sa/4.0/" style="padding-right: 10px;"><img alt="Creative Commons Lizenzvertrag" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a></p>
</div>   
    <div class="nav-footer-center">
<p>All images are generated using Python, R, draw.io, Flux or Stable Diffusion XL if not indicated otherwise.</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/MBrede/generative_ai/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>